# 쿠키
클라이언트의 IP주소와 User-Agent는 매번 변경될 수 있는 고유하지 않은 정보일 뿐만 아니라, HTTP 프로토콜의 **Connectionless**와 **Stateless** 특징 때문에 웹 서버는 클라이언트를 기억할 수 없습니다.

**Connectionless, Stateless** 특성을 갖는 HTTP에서 상태를 유지하기 위해 **쿠키(Cookie)**가 탄생했습니다. <U>쿠키는 Key와 Value로 이뤄진 일종의 단위</U>로, 서버가 클라이언트에게 쿠키를 발급하면, 클라이언트는 서버에 요청을 보낼때마다 쿠키를 같이 전송합니다. 서버는 클라이언트의 요청에 포함된 쿠키를 확인해 클라이언트를 구분할 수 있습니다.
```
HTTP 프로토콜 특징

Connectionless: 하나의 요청에 하나의 응답을 한 후 연결을 종료하는 것을 의미합니다. 특정 요청에 대한 연결은 이후의 요청과 이어지지 않고 새 요청이 있을 때 마다 항상 새로운 연결을 맺습니다.


Stateless: 통신이 끝난 후 상태 정보를 저장하지 않는 것을 의미합니다. 이전 연결에서 사용한 데이터를 다른 연결에서 요구할 수 없습니다.
```
# 용도
일반적으로 쿠키는 클라이언트의 정보 기록과 상태 정보를 표현하는 용도로 사용합니다.
<h2>정보 기록</h2>
웹 서버는 각 클라이언트의 팝업 옵션을 기억하기 위해 쿠키에 해당 정보를 기록하고, 쿠키를 통해 팝업 창 표시 여부를 판단합니다. 과거에는 클라이언트의 정보를 저장하려고 쿠키가 종종 사용됐습니다. 쿠키는 서버와 통신할 때마다 전송되기 때문에 쿠키가 필요없는 요청을 보낼 때 리소스 낭비가 발생할 수 있습니다. 최근에는 이러한 단점을 보완하기 위해 Modern Storage APls를 통해 데이터를 저장하는 방식을 권장하고 있습니다.
<h2>상태 정보</h2>
많은 웹 사이트에서는 회원 가입과 로그인을 통해 개개인에게 맞춤형 서비스를 제공합니다. 웹 서버에서는 수많은 클라이언트의 로그인 상태와 이용자를 구별해야 하는데, 이때 클라이언트를 식별할 수 있는 값을 쿠키에 저장해 사용합니다.

# 쿠키 변조
쿠키는 클라이언트의 브라우저에 저장되고 요청에 포함되는 정보입니다. 따라서 <U>악의적인 클라이언트는 쿠키 정보를 변조해 서버에 요청</U>을 보낼 수 있습니다. 만약 서버가 별다른 검증 없이 쿠키를 통해 이용자의 인증 정보를 식별한다면 공격자가 타 이용자를 사칭해 정보를 탈취할 수 있습니다.
# 세션

쿠키에 인증 상태를 저장하지만 클라이언트가 인증 정보를 변조할 수 없게 하기 위해 **세션(Session)** 을 사용합니다. 세션은 인증 정보를 서버에 저장하고 해당 데이터에 접근할 수 있는 **키(유추할 수 없는 랜덤한 문자열)** 를 만들어 클라이언트에 전달하는 방식으로 작동합니다. 해당 키를 일반적으로 **Session ID**라고 합니다. 브라우저는 해당 키를 쿠키에 저장하고 이후에 HTTP 요청을 보낼 때 사용합니다. 서버는 요청에 포함된 키에 해당하는 데이터를 가져와 인증 상태를 확인합니다. 

쿠키는 데이터 자체를 이용자가 저장하며, 세션은 서버가 저장한다는 핵심적인 차이가 있습니다.
# 쿠키 적용법
쿠키는 클라이언트에 저장되기 때문에 클라이언트는 저장된 쿠키를 조회, 수정, 추가할 수 있습니다. 클라이언트가 서버에 요청을 보낼 때 저장된 쿠키를 요청 헤더에 넣어 전송하기 때문에 이용자가 요청을 보낼 때 쿠키 헤더를 변조할 수 있습니다. 쿠키를 설정할 때에는 만료 시간을 지정할 수 있고, 만료 시간 이후에는 클라이언트(브라우저)에서 관리됩니다.

쿠키는 서버와 클라이언트 둘 다 설정할 수 있습니다.

<h2>서버</h2>
HTTP 응답 중 헤더에 쿠키 설정 헤더 (Set-Cookie)를 추가하면 클라이언트의 브라우저가 쿠키를 설정합니다.

```
HTTP/1.1 200 OK
Server: Apache/2.4.29 (Ubuntu)
Set-Cookie: name=test;
Set-Cookie: age=30; Expires=Fri, 30 Sep 2022 14:54:50 GMT;
...
```
<h2>클라이언트</h2>
자바스크립트를 사용해 쿠키를 설정합니다.

```javascript
HTTP/1.1 200 OK
Server: Apache/2.4.29 (Ubuntu)
Set-Cookie: name=test;
Set-Cookie: age=30; Expires=Fri, 30 Sep 2022 14:54:50 GMT;
...
```
# 크롬 Console을 활용하는 법
크롬 페이지에서 우클릭했을 때 표시되는 검사 버튼을 누른 후 ```Console``` 탭을 누릅니다. ```document.cookie```를 입력하면 쿠키 정보를 확인할 수 있습니다.

**쿠키 옵션(HTTPOnly)에 따라 자바스크립트에서 쿠키 확인이 불가능 할 수 있습니다.**

# 크롬 Application을 활용하는 법
크롬 페이지에서 우클릭했을 때 표시되는 검사 버튼을 누른 후 ```Application``` 탭을 누릅니다. 좌측에 나열된 목록에서 ```Cookies```를 펼치면 Origin 목록을 확인할 수 있습니다.

Origin을 누르면 설정된 쿠키 정보를 확인/수정할 수 있습니다.
# 용어 정리
```
키워드

* Connectionless: 하나의 요청에 하나의 응답을 한 후 연결을 종료하는 것을 의미합니다.

* Stateless: 통신이 끝난 후 상태 정보를 저장하지 않는 것을 의미합니다.

* 쿠키 (Cookie): HTTP에서 상태를 유지하기 위해 사용하는 Key-Value 형태의 값

* 세션 (Session): 쿠키에 포함된 Session ID를 사용해 서버에 저장된 세션 데이터에 접근하는 방식

* 세션 하이재킹 (Session Hijacking): 타 이용자의 쿠키를 훔쳐 인증 정보를 획득하는 공격
